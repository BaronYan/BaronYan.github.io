# 在数据库中,主键和索引有何区别？

主键和索引在数据库中都是用于优化查询性能的重要概念，但它们有一些关键的区别：
1. 定义和唯一性：
    - 主键：每个表只能有一个主键，它唯一标识表中的每一行数据。
    - 索引：一个表可以有多个索引，它们不一定是唯一的。
2. 数据完整性：
    - 主键：强制保证数据的完整性，不允许 NULL 值或重复值。
    - 索引：可以包含重复值和 NULL 值（除非被定义为唯一索引）。
3. 自动创建：
    - 主键：数据库通常会自动为主键创建一个对应的索引。
    - 索引：需要手动创建（除非是主键索引）。
4. 用途：
    - 主键：主要用于唯一标识记录和建立表之间的关系（外键关联）。
    - 索引：主要用于加速数据检索操作。
5. 存储结构：
    - 主键：通常存储为聚集索引（clustered index），决定了表中数据的物理存储顺序。
    - 索引：通常存储为非聚集索引（non-clustered index），不影响数据的物理存储顺序。
6. 性能影响：
    - 主键：对插入和更新操作可能有较大影响，因为可能需要重新组织数据。
    - 索引：主要影响查询性能，但过多的索引会影响插入、更新和删除操作的性能。
7. 强制性：
    - 主键：虽然不是绝对必需，但大多数表都应该有主键以确保数据完整性。
    - 索引：是可选的，根据查询需求添加。
8. 组合字段：
    - 主键：可以是单个字段，也可以是多个字段的组合（复合主键）。
    - 索引：同样可以是单个字段或多个字段的组合。
9. 外键关系：
    - 主键：常用作其他表的外键引用目标。
    - 索引：不直接用于外键关系，但外键列通常建议创建索引以提高查询性能。
10. 数据库维护：
    - 主键：更改主键通常是一个复杂的操作，可能需要重构数据库结构。
    - 索引：可以相对容易地添加、修改或删除，不会影响表的结构。

在实际应用中，主键和索引都是优化数据库性能的重要工具。主键确保了数据的唯一性和完整性，而索引则提供了灵活的方式来加速特定类型的查询。理解它们的区别和适用场景对于设计高效的数据库结构至关重要。

## 如何添加主键，如何添加索引？

在 Laravel 的数据库迁移中，添加主键和索引的方法略有不同。让我为您详细解释如何添加主键和索引：

### 添加主键

主键通常在创建表时就定义好。在 Laravel 的迁移文件中，有几种方式可以添加主键：

```php
// 使用 id() 方法（自增整数主键）
$table->id();

// 使用 bigIncrements() 方法（自增大整数主键）
$table->bigIncrements('id');

// 使用 uuid() 或 ulid() 方法（UUID 或 ULID 主键）
$table->uuid('id')->primary();
$table->ulid('id')->primary();

// 自定义主键
$table->string('email')->primary();

// 复合主键
$table->unsignedBigInteger('order_id');
$table->unsignedBigInteger('product_id');
$table->primary(['order_id', 'product_id']);
```
### 添加索引

索引可以在创建表时添加，也可以在之后通过修改表结构来添加。以下是几种添加索引的方法：

```php
// 普通索引
$table->index('email');

// 唯一索引
$table->unique('email');

// 复合索引
$table->index(['last_name', 'first_name']);

// 全文索引（仅支持某些数据库，如 MySQL）
$table->fullText('content');

// 空间索引（用于地理数据，仅支持某些数据库）
$table->spatialIndex('coordinates');

// 自定义索引名称
$table->index('email', 'user_email_index');
```

### 注意事项：
1. 主键自动创建索引，不需要额外添加索引。
2. 外键关系会自动在关联列上创建索引。
3. 添加索引可能会影响数据库的写入性能，因此需要权衡查询性能和写入性能。
4. 某些数据库对索引数量有限制，添加索引时需要考虑这一点。
5. 在大型表上添加索引可能需要较长时间，可能会影响数据库性能。

在实际应用中，您应该根据查询模式和性能需求来决定添加哪些索引。过多的索引可能会降低写入性能，而不足的索引可能会影响查询性能。因此，需要在两者之间找到平衡。