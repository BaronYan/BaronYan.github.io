import{_ as n,c as s,o as a,d as p}from"./app-B6iif8NC.js";const t={},e=p(`<h1 id="多子域名配置" tabindex="-1"><a class="header-anchor" href="#多子域名配置"><span>多子域名配置</span></a></h1><ol><li>在域名解析设置里设置一条 <code>CNAME</code> 解析记录: <code>*.qkcargo.com</code></li><li>在服务器管理后端，例如 BT 面板里，设置网站，添加泛域名:<code>*.qkcargo.com</code></li><li>配置 Laravel (在 Laravel 中，你需要设置中间件来处理子域名的重定向。假设每个用户有一个唯一的子域名，你可以在用户登录后进行重定向。) <ol><li><strong>创建中间件</strong>,生成一个新的中间件来处理重定向：<code>php artisan make:middleware RedirectToSubdomain</code></li><li>添加逻辑来处理子域名重定向<div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre class="language-php"><code><span class="line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\\</span>Http<span class="token punctuation">\\</span>Middleware</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Closure</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Facades<span class="token punctuation">\\</span>Auth</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">RedirectToSubdomain</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">Closure</span> <span class="token variable">$next</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 假设用户模型有一个 \`subdomain\` 属性</span></span>
<span class="line">            <span class="token variable">$subdomain</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">subdomain</span><span class="token punctuation">;</span> </span>
<span class="line"></span>
<span class="line">            <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">!==</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$subdomain</span><span class="token punctuation">}</span></span>.yourdomain.com&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">getScheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;://&#39;</span> <span class="token operator">.</span> <span class="token variable">$subdomain</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;.yourdomain.com&#39;</span> <span class="token operator">.</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">getRequestUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">away</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>注册中间件</li><li>在用户登录后设置子域名,在登录控制器中，设置用户的子域名（假设你在 users 表中有一个 subdomain 列）：<code>return redirect()-&gt;to(&quot;http://{$subdomain}.yourdomain.com&quot;);</code></li></ol></li></ol>`,2),o=[e];function c(l,i){return a(),s("div",null,o)}const r=n(t,[["render",c],["__file","多子域名配置.html.vue"]]),k=JSON.parse(`{"path":"/jiyun/%E5%A4%9A%E5%AD%90%E5%9F%9F%E5%90%8D%E9%85%8D%E7%BD%AE.html","title":"多子域名配置","lang":"en-US","frontmatter":{},"headers":[],"git":{"updatedTime":1725369889000,"contributors":[{"name":"BaronYan","email":"1229598328@qq.com","commits":1}]},"filePathRelative":"jiyun/多子域名配置.md","excerpt":"\\n<ol>\\n<li>在域名解析设置里设置一条 <code>CNAME</code> 解析记录: <code>*.qkcargo.com</code></li>\\n<li>在服务器管理后端，例如 BT 面板里，设置网站，添加泛域名:<code>*.qkcargo.com</code></li>\\n<li>配置 Laravel (在 Laravel 中，你需要设置中间件来处理子域名的重定向。假设每个用户有一个唯一的子域名，你可以在用户登录后进行重定向。)\\n<ol>\\n<li><strong>创建中间件</strong>,生成一个新的中间件来处理重定向：<code>php artisan make:middleware RedirectToSubdomain</code></li>\\n<li>添加逻辑来处理子域名重定向<div class=\\"language-php\\" data-highlighter=\\"prismjs\\" data-ext=\\"php\\" data-title=\\"php\\"><pre class=\\"language-php\\"><code><span class=\\"line\\"><span class=\\"token keyword\\">namespace</span> <span class=\\"token package\\">App<span class=\\"token punctuation\\">\\\\</span>Http<span class=\\"token punctuation\\">\\\\</span>Middleware</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">use</span> <span class=\\"token package\\">Closure</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">use</span> <span class=\\"token package\\">Illuminate<span class=\\"token punctuation\\">\\\\</span>Support<span class=\\"token punctuation\\">\\\\</span>Facades<span class=\\"token punctuation\\">\\\\</span>Auth</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name-definition class-name\\">RedirectToSubdomain</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">public</span> <span class=\\"token keyword\\">function</span> <span class=\\"token function-definition function\\">handle</span><span class=\\"token punctuation\\">(</span><span class=\\"token variable\\">$request</span><span class=\\"token punctuation\\">,</span> <span class=\\"token class-name type-declaration\\">Closure</span> <span class=\\"token variable\\">$next</span><span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token class-name static-context\\">Auth</span><span class=\\"token operator\\">::</span><span class=\\"token function\\">check</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">            <span class=\\"token variable\\">$user</span> <span class=\\"token operator\\">=</span> <span class=\\"token class-name static-context\\">Auth</span><span class=\\"token operator\\">::</span><span class=\\"token function\\">user</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token comment\\">// 假设用户模型有一个 \`subdomain\` 属性</span></span>\\n<span class=\\"line\\">            <span class=\\"token variable\\">$subdomain</span> <span class=\\"token operator\\">=</span> <span class=\\"token variable\\">$user</span><span class=\\"token operator\\">-&gt;</span><span class=\\"token property\\">subdomain</span><span class=\\"token punctuation\\">;</span> </span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token variable\\">$host</span> <span class=\\"token operator\\">=</span> <span class=\\"token variable\\">$request</span><span class=\\"token operator\\">-&gt;</span><span class=\\"token function\\">getHost</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">            </span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token variable\\">$host</span> <span class=\\"token operator\\">!==</span> <span class=\\"token string double-quoted-string\\">\\"<span class=\\"token interpolation\\"><span class=\\"token punctuation\\">{</span><span class=\\"token variable\\">$subdomain</span><span class=\\"token punctuation\\">}</span></span>.yourdomain.com\\"</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token variable\\">$url</span> <span class=\\"token operator\\">=</span> <span class=\\"token variable\\">$request</span><span class=\\"token operator\\">-&gt;</span><span class=\\"token function\\">getScheme</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">.</span> <span class=\\"token string single-quoted-string\\">'://'</span> <span class=\\"token operator\\">.</span> <span class=\\"token variable\\">$subdomain</span> <span class=\\"token operator\\">.</span> <span class=\\"token string single-quoted-string\\">'.yourdomain.com'</span> <span class=\\"token operator\\">.</span> <span class=\\"token variable\\">$request</span><span class=\\"token operator\\">-&gt;</span><span class=\\"token function\\">getRequestUri</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">                <span class=\\"token keyword\\">return</span> <span class=\\"token function\\">redirect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token operator\\">-&gt;</span><span class=\\"token function\\">away</span><span class=\\"token punctuation\\">(</span><span class=\\"token variable\\">$url</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">return</span> <span class=\\"token variable\\">$next</span><span class=\\"token punctuation\\">(</span><span class=\\"token variable\\">$request</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span></code></pre></div></li>\\n<li>注册中间件</li>\\n<li>在用户登录后设置子域名,在登录控制器中，设置用户的子域名（假设你在 users 表中有一个 subdomain 列）：<code>return redirect()-&gt;to(\\"http://{$subdomain}.yourdomain.com\\");</code></li>\\n</ol>\\n</li>\\n</ol>"}`);export{r as comp,k as data};
