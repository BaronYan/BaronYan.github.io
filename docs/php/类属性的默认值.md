
**在 PHP 中，为什么类属性的默认值必须是常量表达式?**


<span class="font-bold text-red-500">在 PHP 中，类属性的默认值必须是常量表达式，这是为了确保属性的默认值在类定义时就能确定和分配，而不是在运行时动态计算。</span>

具体原因如下：
- **性能考虑**：类的定义通常发生在脚本加载阶段（即编译阶段），而不是运行阶段。使用常量表达式可以在编译阶段就确定属性的默认值，减少运行时的开销。
- **一致性和可预测性**：常量表达式确保了类属性的默认值在任何情况下都是确定的、可预测的。如果允许使用动态计算的表达式，默认值可能会根据运行时的不同情况发生变化，导致代码的行为变得难以预测和调试。
- **内存优化**：编译阶段确定的常量表达式可以更好地优化内存使用。例如，对于常量字符串或数字，PHP 引擎可以在内存中共享这些值，而不需要在每个类实例中重复存储。
- **语法和实现简单化**：强制使用常量表达式简化了 PHP 语言的语法和解释器的实现。处理动态表达式需要更复杂的解析和运行时处理机制，这会增加语言的复杂性和运行时开销。

### 常量表达式示例
在 PHP 中，以下是合法的类属性默认值：

```php
class Example {
    public $number = 10;        // 整数常量
    public $text = 'Hello';     // 字符串常量
    public $array = [1, 2, 3];  // 数组常量
    public $boolean = true;     // 布尔常量
}
```
而以下是非法的类属性默认值，因为它们不是常量表达式：
```php
class Example {
    public $value = rand(1, 100);     // 非法，rand() 是一个动态函数
    public $object = new DateTime();  // 非法，new 创建对象是动态操作
}
```
对于需要动态初始化的属性，通常的做法是在构造函数中进行赋值：
```php
class Example {
    public $value;
    public $object;

    public function __construct() {
        $this->value = rand(1, 100);
        $this->object = new DateTime();
    }
}
```

通过这种方式，既可以保持类属性的默认值为常量表达式的约束，又能够在实例化对象时动态地初始化属性值。